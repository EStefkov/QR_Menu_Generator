# QR Menu Generator - Документация на Frontend

## 5.3. Изгледи (Views) – Front-end (React)

Изгледите в Spring Boot приложението са заменени от клиентската част (Front-end) – React. React е модерна JavaScript библиотека за създаване на потребителски интерфейси в уеб приложения. Тя използва декларативен подход за създаване на компоненти, които са малки, изолирани и преизползваеми блокове на UI.

Главните елементи на React в QR Menu Generator включват:
• **Компоненти** - основните строителни блокове на приложението, организирани в логическа йерархия (NavBar, ProductCard, Cart, OrderHistory, AccountsTable и др.).
• **Състояние (state)** - управлявано чрез React Hooks (useState) за локално състояние и Context API (AuthContext, CartContext, LanguageContext, ThemeContext) за глобално състояние.
• **Пропс (props)** - данни, които се предават между компонентите за комуникация и споделяне на информация.
• **Животен цикъл на компонента** - управляван чрез useEffect Hook за странични ефекти, API заявки и cleanup операции.
• **Virtual DOM** - виртуално представяне на DOM, което позволява на React да обновява само променените части без презареждане на цялата страница.
• **React Router** - за навигация и маршрутизация с защитени маршрути според ролята на потребителя.
• **Hooks** - за управление на състоянието и логиката (useState, useEffect, useContext, useNavigate).

Архитектурата на приложението включва:
• **Технологичен стек**: React 19.0.0, Vite 6.2.0, TailwindCSS 4.0.14, React Router DOM 7.2.0, Axios 1.8.1
• **Структура**: Организирани компоненти в папки по функционалност (admin, manager, dashboard, restaurants, modals)
• **Автентикация**: JWT токен базирана система с роли (ADMIN, MANAGER, COMANAGER, USER, WAITER)
• **Интернационализация**: Поддръжка за български и английски език чрез React i18next
• **Тематизиране**: Светла и тъмна тема с автоматично засичане на системните предпочитания
• **Responsive дизайн**: Оптимизиран за мобилни устройства с TailwindCSS

Използването на React в клиентската част на QR Menu Generator приложението предлага модерна, ефективна и мащабируема архитектура за създаване на динамични потребителски интерфейси. Системата осигурява отлично потребителско изживяване чрез бързо зареждане, smooth навигация и адаптивен дизайн за всички устройства.

## 5.3.8. Сигурност и конфигурация

Сигурността на QR Menu Generator приложението е изградена на няколко нива, включващи backend конфигурация, JWT автентикация, CORS политики и защитени маршрути. Системата използва модерни security практики за защита на данните и контрол на достъпа.

### 5.3.8.1. CORS конфигурация (CorsConfig.java)

**Cross-Origin Resource Sharing (CORS)** конфигурацията позволява на frontend приложението да комуникира с backend API от различни домейни и портове.

**Ключови настройки:**
- **Разрешени origins**: Vite development server (localhost:5173), production host, backend port (localhost:8080)
- **Credentials поддръжка**: Активирана за JWT токен предаване
- **Разрешени headers**: Authorization, Content-Type, Accept и други необходими headers
- **Exposed headers**: Access-Control-Allow-Origin, Authorization за frontend достъп
- **HTTP методи**: GET, POST, PUT, PATCH, DELETE, OPTIONS
- **Max Age**: 3600 секунди за кеширане на preflight заявки

**Предимства:**
- Гъвкава конфигурация за различни среди (development/production)
- Сигурна комуникация между frontend и backend
- Поддръжка за credentials и custom headers
- Оптимизация чрез кеширане на CORS заявки

### 5.3.8.2. Spring Security конфигурация (SecurityConfig.java)

**Spring Security** осигурява цялостната сигурност на приложението чрез детайлна конфигурация на достъпа до различните endpoints.

**Публични endpoints (без автентикация):**
- `/api/auth/**` - автентикация endpoints
- `/api/accounts/register`, `/api/accounts/login`, `/api/accounts/validate`
- `/api/menus/**` (GET заявки) - публичен достъп до менюта
- `/api/products/menu/**` (GET) - продукти в менютата
- `/api/categories/**` (GET) - категории продукти
- `/uploads/**` - статични ресурси (снимки, файлове)
- QR код генериране и публични поръчки

**Роля-базиран достъп:**
- **ADMIN**: Пълен достъп до всички функционалности
- **MANAGER**: Управление на ресторанти и менюта
- **COMANAGER**: Ограничен достъп до определени ресторанти
- **USER**: Основни потребителски функции
- **WAITER**: Специфични функции за сервитьори

**Защитени endpoints:**
- Управление на акаунти (PUT, POST с роля проверка)
- CRUD операции за ресторанти, продукти, категории
- Поръчки и любими продукти (само за автентикирани потребители)
- Административни функции (само за админи)

### 5.3.8.3. Web конфигурация (WebConfig.java)

**WebConfig** управлява статичните ресурси и Spring Data Web поддръжката.

**Статични ресурси:**
- Конфигурация на `/uploads/**` URL mapping
- Автоматично мапване към физическата `uploads/` директория
- Поддръжка за всички поддиректории на произволна дълбочина
- Абсолютен път за сигурност и стабилност

**Spring Data Web:**
- Активирана поддръжка за пагинация чрез DTO
- Автоматично сериализиране на Page обекти
- Оптимизирана работа с големи datasets

### 5.3.8.4. JWT Request Filter (JwtRequestFilter.java)

**JWT филтърът** е централният компонент за автентикация и авторизация в приложението.

**Функционалности:**
- **Токен извличане**: Автоматично извличане на JWT от Authorization header
- **Валидация**: Проверка на токен валидност и срок на годност
- **Роля извличане**: Извличане на accountType от JWT claims
- **Security Context**: Настройване на Spring Security контекста
- **Публични endpoints**: Пропускане на автентикация за публични URL-и

**Процес на автентикация:**
1. Извличане на JWT токен от "Bearer " header
2. Парсване и валидация на токена
3. Извличане на username и accountType от claims
4. Зареждане на UserDetails от базата данни
5. Създаване на Authentication обект с правилните роли
6. Настройване на SecurityContext за текущата заявка

**Error handling:**
- Graceful обработка на изтекли токени (ExpiredJwtException)
- Логване на грешки при невалидни токени
- Продължаване на filter chain при проблеми

### 5.3.8.5. Menu Mapper (MenuMapper.java)

**MenuMapper** осигурява сигурно мапване между Entity и DTO обекти за менютата.

**Функции:**
- **Data Transfer Object (DTO) конвертиране**: Безопасно мапване на Menu entity към MenuDTO
- **Null safety**: Проверка за null стойности при мапване на релации
- **Selective exposure**: Излагане само на необходимите данни към frontend
- **Security by design**: Предотвратяване на data leakage чрез контролирано мапване

**Мапвани полета:**
- Основни данни: id, category, createdAt, updatedAt
- URL данни: menuUrl, qrCodeImage, menuImage
- Стилизиране: textColor
- Релации: restaurantId (само ID, не цялата entity)

### 5.3.8.6. Security Utils (SecurityUtils.java)

**SecurityUtils** предоставя помощни методи за работа с текущия автентикиран потребител.

**Основни методи:**
- **getCurrentUserId()**: Извличане на ID на текущия потребител
- **Authentication проверка**: Валидация на автентикация статуса
- **UserDetails обработка**: Безопасна работа с UserDetails обекти
- **Error handling**: Graceful обработка на случаи без автентикация

**Сигурностни проверки:**
- Проверка за null authentication
- Валидация на authenticated статус
- Обработка на "anonymousUser" случаи
- Type safety при работа с Principal обекти

### 5.3.8.7. Интеграция с Frontend

**JWT Token Management:**
- Автоматично добавяне на токен в Axios interceptors
- Съхранение в localStorage с expiration проверка
- Автоматично refresh при изтичане (планирано)
- Изчистване при logout

**Role-based UI:**
- Динамично показване/скриване на UI елементи според роля
- Защитени маршрути с ProtectedRoute компонент
- Условно рендериране на функционалности
- Автоматично пренасочване при неоторизиран достъп

**Error Handling:**
- Централизирано обработване на 401/403 грешки
- Toast уведомления за security проблеми
- Автоматично logout при невалиден токен
- User-friendly съобщения за грешки

### 5.3.8.8. Сигурностни мерки

**Защита срещу атаки:**
- **CSRF Protection**: Disabled заради stateless JWT архитектура
- **XSS Prevention**: Валидация на входни данни и output encoding
- **SQL Injection**: Използване на JPA/Hibernate prepared statements
- **Path Traversal**: Контролиран достъп до статични ресурси

**Best Practices:**
- Principle of Least Privilege за роли и permissions
- Secure defaults в конфигурацията
- Regular security audits на dependencies
- Proper error handling без information disclosure

**Monitoring и Logging:**
- Детайлно логване на authentication събития
- Security event tracking
- Failed login attempt monitoring
- Suspicious activity detection

Сигурностната архитектура на QR Menu Generator осигурява надеждна защита на данните и контрол на достъпа, като същевременно поддържа добро потребителско изживяване и производителност на приложението.

## 6. Тестване на системата

### 6.1. Структура на приложението

Приложението е организирано в модулна архитектура с ясно разделение между frontend и backend частите. Backend частта използва Spring Boot с контролери, сервиси и repositories, докато frontend частта е изградена с React компоненти, организирани в логическа йерархия.

### 6.2. Важни файлове и компоненти

**Backend ключови файлове:**
• **AccountController.java** - управление на потребителски акаунти и автентикация
• **SecurityConfig.java** - конфигурация на сигурността и достъпа
• **JwtRequestFilter.java** - филтър за JWT автентикация
• **CorsConfig.java** - конфигурация за cross-origin заявки

**Frontend ключови компоненти:**
• **App.jsx** - главен компонент с маршрутизация
• **NavBar.jsx** - навигационна лента с роля-базирано меню
• **ProtectedRoute.jsx** - защитени маршрути според роля
• **AuthContext.jsx** - глобално състояние за автентикация

### 6.3. Проведени тестове

#### 6.3.1. Тестване на сървърна част

При разработването на сървърната част на системата бяха направени автоматизирани функционални тестове на всички маршрути на системата. За изпълнението е използван Spring Boot Test framework с JUnit 5 и Mockito.

**6.3.1.1. AccountController тестове**

Тестовете на HTTP заявките за потребителите са важни, за да се гарантира, че приложението функционира коректно при взаимодействие с потребителската система. Те се използват за проверка на функционалността на автентикация, авторизация и управление на потребителски данни.

Списък с част от направените тестове:
• Тест за регистрация на нов потребител с валидни данни
• Тест за регистрация с вече съществуващ имейл адрес
• Тест за вход в системата с валидни потребителски данни
• Тест за вход в системата с невалидни потребителски данни
• Тест за валидация на JWT токен
• Тест за получаване на текущ потребител по токен
• Тест за смяна на парола с валидни данни
• Тест за смяна на парола с невалидна стара парола
• Тест за качване на профилна снимка
• Тест за обновяване на роля на потребител (само админи)

**6.3.1.2. RestaurantController тестове**

Тестовете на заявките за ресторанти гарантират правилното функциониране на системата за управление на ресторанти и техните менюта.

Списък с част от направените тестове:
• Тест за създаване на ресторант с валидни данни
• Тест за създаване на ресторант с невалидни данни
• Тест за получаване на всички ресторанти
• Тест за получаване на ресторант по идентификатор
• Тест за обновяване на ресторант от собственика
• Тест за изтриване на ресторант (само админи)
• Тест за получаване на менюто на ресторант
• Тест за качване на лого на ресторант

**6.3.1.3. ProductController тестове**

Целта на тестовете на HTTP заявките за продукти е да се увери, че системата работи правилно при управление на продуктите в менютата.

Списък с част от направените тестове:
• Тест за създаване на продукт с валидни данни
• Тест за създаване на продукт с невалидни данни
• Тест за получаване на продукт по идентификатор
• Тест за получаване на всички продукти с пагинация
• Тест за получаване на продукти по категория
• Тест за обновяване на продукт
• Тест за изтриване на продукт
• Тест за качване на снимка на продукт

**6.3.1.4. OrderController тестове**

Тестовете на заявките за поръчки позволяват да се провери как системата обработва поръчките и каква е реакцията й при определени сценарии.

Списък с част от направените тестове:
• Тест за създаване на поръчка с валидни данни
• Тест за създаване на поръчка с невалидни данни
• Тест за получаване на поръчка по идентификатор
• Тест за получаване на всички поръчки с филтриране
• Тест за обновяване на статуса на поръчка
• Тест за изтриване на поръчка
• Тест за получаване на поръчки по ресторант
• Тест за получаване на поръчки по потребител

#### 6.3.2. Тестване на клиентска част

При разработване на клиентската част на системата бяха извършени ръчни тестове при различни сценарии. По време на провеждането на тестовете бяха открити и отстранени значителен брой проблеми, като някои от тях са:

• Системата правеше опит да изобрази продукти, които не са получени от сървърната част
• При опит за обновяване на данни в администраторския панел, клиентската част пращаше грешен идентификатор към сървърната част
• Неправилно запазване на JWT токена в локалното хранилище след успешен вход в системата
• Данните от кеш паметта не се изчистват след актуализиране, триене или създаване на нов продукт
• Неправилно пренасочване при различни роли на потребители
• Загуба на състоянието на кошницата при презареждане на страницата
• Проблеми с многоезичната поддръжка при смяна на езика
• Неправилно показване на модални прозорци на мобилни устройства
• Бавно зареждане на изображения при слаба интернет връзка

#### 6.3.3. Таблица с основни тестове

| Тест | Тип | Очакван резултат | Статус | Забележки |
|------|-----|------------------|--------|-----------|
| Регистрация с валидни данни | Функционален | Успешно създаване на акаунт | Успешен | JWT токен се връща коректно |
| Вход с невалидни данни | Функционален | Грешка 401 Unauthorized | Успешен | Подходящо съобщение за грешка |
| Качване на профилна снимка | Функционален | Снимката се запазва и показва | Успешен | Поддържа различни формати |
| Създаване на ресторант | Функционален | Ресторант се създава успешно | Успешен | QR код се генерира автоматично |
| Добавяне на продукт в кошница | Функционален | Продуктът се добавя в кошницата | Успешен | Количеството се обновява |
| Responsive дизайн | UI/UX | Правилно показване на мобилни устройства | Успешен | Тестван на различни размери екрани |
| Смяна на език | Функционален | Интерфейсът се превежда напълно | Частично успешен | Някои етикети не се обновяват веднага |
| Автентикация с изтекъл токен | Сигурностен | Автоматично пренасочване към login | Успешен | Потребителят се уведомява |
| CORS заявки | Интеграционен | Успешна комуникация frontend-backend | Успешен | Работи за всички endpoints |
| Натоварване с много поръчки | Производителност | Системата остава отзивчива | Успешен | Тестван с 100+ едновременни заявки | 